<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Ratchet template page</title>

        <!-- Sets initial viewport load and disables zooming  -->
        <meta name="viewport" content="initial-scale=1, maximum-scale=1">

        <!-- Makes your prototype chrome-less once bookmarked to your phone's home screen -->
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <!-- Include the compiled Ratchet CSS -->
        <link href="assets/css/ratchet.min.css" rel="stylesheet">
        <link href="assets/css/style.css" rel="stylesheet">
		<link href="assets/css/font-awesome.css" rel="stylesheet">

        <!-- Include the compiled Ratchet JS -->
        <script src="assets/js/ratchet.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
    </head>
    <body>

        <!-- Make sure all your bars are the first things in your <body> -->
        <header class="bar bar-nav">
            <div class="header">
				<a id="to_church" class="icon icon-left-nav pull-left"></a>
                <h1 class="title"><span id="nom_vitrail">Sans Nom</span></h1>
            </div>
        </header>

        <!-- Wrap all non-bar HTML in the .content div (this is actually what scrolls) -->
        <div class="content">
            <section class="first">
                <div class="thumbnail-container">
					<a id="img-resource" href="">
						<div class="overlay-text">
							<img src="search.png" /> 
						</div>
						<img id="thumb_vitrail" class="zoomable thumbnail" src=""  />
					</a>
                </div>
                <div class="social">
                    <i class="fa fa-facebook-square fa-2x"></i>
                    <i class="fa fa-google-plus-square fa-2x"></i>
                    <i class="fa fa-twitter-square fa-2x"></i>
                </div>
            </section>
            <section class="description">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim
            </section>
        </div>

    </body>
    <script>
		function getUrlVars() {
			var vars = {};
			var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
				vars[key] = value;
			});
			return vars;
		}
		
		function adaptOverlay(){
			var imgwidth = $("#thumb_vitrail").width();
			var imgheight = $("#thumb_vitrail").height();
			$(".overlay").css("width",imgwidth);
			$(".overlay-text").css("width",imgwidth);
			$(".overlay").css("height",imgheight);
		}
		
		var id = getUrlVars()["id"];
		var eglise = getUrlVars()["eglise"];
		var viewpoint = getUrlVars()["viewpoint"];
		var topic = getUrlVars()["topic"];
		$("a#topic").prop("href","explore.html?topic=" + topic + "&viewpoint=" + viewpoint + "&eglise=" + eglise );
        $.ajax({
            url : "http://steatite.hypertopic.org/corpus/Vitraux - BÃ©nel",  
            type : "GET",
            dataType: 'json',
            success: function(data){
                for (var i in data["rows"]){
					if (data["rows"][i]["key"][1] == id ){
						if (typeof data["rows"][i]["value"]["name"] != 'undefined')
							name = data["rows"][i]["value"]["name"];
						if (typeof data["rows"][i]["value"]["thumbnail"] != 'undefined')
							thumb = data["rows"][i]["value"]["thumbnail"];
						if (typeof data["rows"][i]["value"]["resource"] != 'undefined')
							img = data["rows"][i]["value"]["resource"];
					}
				}
				if ($("span#nom_vitrail").html() !="Sans Nom" ){
					$("span#nom_vitrail").html(name);
				}
				$("img#thumb_vitrail").prop("src",thumb);
				$("a#img-resource").prop("href",img);
				setTimeout(adaptOverlay(),1000);
            }
        });
		$.ajax({
			url :"http://argos2.hypertopic.org/viewpoint/56e092d8a6179a788c74b618b29801c0",
			type : "GET",
            dataType: 'json',
			success: function(data){
				for (var i in data["rows"]){
					if (typeof data["rows"][i]["value"]["item"] != 'undefined'){
						if (data["rows"][i]["value"]["item"]["id"] == id ){
							if (typeof data["rows"][i]["value"]["item"]["name"] != 'undefined')
								name = data["rows"][i]["value"]["item"]["name"];
						}
					}
				}
				$("span#nom_vitrail").html(name);				
			}
		});
		$.ajax({
			url :"http://argos2.hypertopic.org/viewpoint/a76306e4f17ed4f79e7e481eb9a1bd06",
			type : "GET",
            dataType: 'json',
			success: function(data){
				for (var i in data["rows"]){
					if (typeof data["rows"][i]["value"]["item"] != 'undefined'){
						if (data["rows"][i]["value"]["item"]["id"] == id ){
							if (typeof data["rows"][i]["value"]["item"]["name"] != 'undefined')
								name = data["rows"][i]["value"]["item"]["name"];
						}
					}
				}
				$("span#nom_vitrail").html(name);
			}
		});
	</script>
</html>
